# インターフェース
通信にはHTTPサーバーとHTTPクライアントを使用する。

![server communication](com.png)

# リソース
要件:
- 相手サーバーにあるリソースは必要になったときに要求できるように
- サーバーにあるリソースに変化があった場合に、そのイベントを受け取れるように
  - イベントの種類(CRUD、リソースのタイプなど)を選択できると便利？

# サーバー関係
要件:
- 相手サーバーが誰であるかを識別できるように
- 同じドメインで別のサーバーを運用できるようにする
- 別のドメインにサーバーを移行できるように
- サーバーが閉鎖された後に偽サーバーが運用されることを防ぐ
- 移行先のドメインを通知できるように (TODO)

## サーバー間の暗号化
通信する相手サーバーにある公開鍵を取得する。
HTTPリクエストを送信する際は、その公開鍵でデータを暗号化して送信する。暗号化にはAES暗号を使用する。
- (まだ鍵を取得していない場合) 相手のサーバーが公開している公開鍵を取得し、保存する。
- (既に鍵を取得している場合) 保存している鍵を使用する。

## 相手サーバーが誰であるかを識別する
サーバーが公開している公開鍵で識別できる。

相手サーバーが公開している鍵とローカルサーバーが保持している鍵が異なる場合、
別のサーバーに変わったと判断できる。

## 別のドメインにサーバーを移行
公開鍵はそのままで、別のドメインにサーバーが移行される可能性がある。
サーバーは公開鍵で識別できる。

### サーバーの移行先を検出する
別のドメインにサーバーが移行しているかどうかを確認する。公開鍵を元にして移行先ドメインを検索する。
移行先が見つからなかった場合、ローカルサーバーはそのサーバーへのデータ送信を全てキャンセルする。

## サーバーが閉鎖された後に偽サーバーが運用されることを防ぐ
例えば、偽のサーバーが公開鍵を偽装したとしても、
その相手サーバーが秘密鍵を持っていない限りは、送信したデータを復号化することができない。
